# Base Dockerfile
**Dockerfile** — это файл с инструкциями, по которым создаётся образ.
Основные инструкции есть в уроке, а полный список опубликован в официальной документации.

```shell
# создать образ на основе базового слоя python (там будет ОС и интерпретатор Python)
FROM python:3.8.5

# создать директорию /code
RUN mkdir /code

# скопировать файл requirements.txt из директории, в которой лежит докерфайл, в директорию /code
COPY requirements.txt /code

# выполнить команду (как в терминале, с тем же синтаксисом) для установки пакетов из requirements.txt
RUN pip3 install -r /code/requirements.txt

# скопировать всё содержимое директории, в которой лежит докерфайл, в директорию /code
COPY . /code

# при старте контейнера выполнить runserver 
CMD python /code/manage.py runserver 0:8000
```

минимальный Dockerfile
```shell
FROM python:3.8.5

WORKDIR /code

COPY requirements.txt .

RUN pip3 install -r requirements.txt

COPY . .
```

## FROM
Инструкция `FROM` определяет базовый образ, на основе которого создаётся образ:
```shell
FROM <image>:<tag>
# <image> — имя базового образа, например ubuntu
# <tag> — необязательный параметр, указывает конкретную версию образа

```
Если не указать версию образа, то будет установлена последняя версия (и тег **latest**), но хорошей практикой является явное указание версии.

## LABEL
Инструкция`LABEL` задаёт служебную информацию об образе, это может быть информация об авторе (`author=...`), о версии образа (`version=...`), о дате релиза или о числе сломанных в процессе работы клавиатур (`broken_keyboards=...`). Пары «ключ-значение» записываются через пробел, ключи придумывает сам разработчик:
```shell
LABEL <ключ>=<значение> <ключ>=<значение> ...
```
Например, `LABEL author='praktikum@yandex.ru' version=1 broken_keyboards=5`.

## COPY
Инструкция `COPY` копирует файлы и директории из указанной директории в директорию контейнера:
```shell
COPY <файл/директория> <путь-внутри-контейнера>
# альтернативный вариант записи:
COPY ["<файл/директория>", "<путь-внутри-контейнера>"]
```
Например, `COPY api /app`.

Если вы не хотите, чтобы какие-то файлы попали в контейнер, перечислите их в `.dockerignore`, принцип такой же, как с `.gitignore`.

## RUN
`RUN` выполняет команды внутри контейнера так, как если бы эти команды выполнялись в терминале. Например, можно вызвать утилиту или просто создать директорию через `mkdir`. Чтобы эта инструкция работала — *base image* должен содержать все необходимые утилиты
```shell
RUN <команда>
# Например
RUN mkdir /code
```

## ENV
Инструкция `ENV` задаёт переменные окружения в контейнере:
```shell
ENV <ключ> <значение>
```
Например,
```shell
ENV DATABASE_NAME yamdb
```
```shell
ENV DATABASE_PORT 5432
```
Использование `ENV` — хорошая практика: секретные данные (ключи, пароли, токены) лучше не хранить в коде.

## WORKDIR
Инструкция `WORKDIR` задаёт в образе директорию, из которой будут выполняться все команды, следующие за этой инструкцией; `WORKDIR` работает аналогично команде `cd` в терминале. В инструкции должен быть указан абсолютный путь директории.
```shell
WORKDIR <путь-внутри-контейнера>
```
Например, после выполнения инструкции `WORKDIR /code/app` все команды в образе будут выполняться из `/code/app`.

Следовательно, команда копирования файлов в директорию `code/app` должна выглядеть не `COPY . /code/app`, а лаконичнее: `COPY . .`

## CMD
Эта инструкция выполняет команду при старте контейнера. Синтаксис команд может быть таким же, как в терминале:
```shell
CMD <команда>
# Например
CMD python3 ./my_script.py
# Или
CMD python3 manage.py runserver
```

### Сборка образа
```shell
docker build -t yamdb .
```

### Запуск контейнера в интерактивном режиме
```shell
docker run -it -p 8000:8000 yamdb.
```

### Остановка контейнера
```shell
docker container stop <CONTAINER ID>
```

### Выполнение команд внутри контейнера
Например запуск `bash`
```shell
docker exec -it <CONTAINER ID> bash.
```

### Публикация образа в docker-hub
Билд образа для публикации ТОЧКА В КОНЦЕ ОБЯЗАТЕЛЬНА
```shell
docker build -t <USERNAME>/<REPOSITORY_NAME>:latest .
```
Логин в докер хабе
```shell
docker login
```
Пуш образа
```shell
docker push <USERNAME>/<REPOSITORY_NAME>:latest
```
